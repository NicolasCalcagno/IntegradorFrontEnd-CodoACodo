services:
  conferencia-buenos-aires:
    build: .
    container_name: conferencia-buenos-aires
    user: 1002:1002
    read_only: true
    cap_drop:
      - ALL
    tmpfs:
      - /tmp
      - /var/lib/php/sessions
    labels:
      - traefik.enable=true
      - traefik.http.services.conferencia-buenos-aires.loadbalancer.server.port=5001
      - traefik.http.services.conferencia-buenos-aires.loadbalancer.server.scheme=http
      - traefik.http.routers.conferencia-buenos-aires.entrypoints=websecure
      - traefik.http.routers.conferencia-buenos-aires.rule=Host(`projects.nicolascalcagno.dev`) && PathPrefix(`/conferencia-buenos-aires/`)
      - traefik.http.routers.conferencia-buenos-aires.tls=true
      - traefik.http.routers.conferencia-buenos-aires.tls.certresolver=cloudflare
      - traefik.http.middlewares.conferencia-buenos-aires-strip.stripprefix.prefixes=/conferencia-buenos-aires
      - traefik.http.routers.conferencia-buenos-aires.middlewares=conferencia-buenos-aires-strip
    env_file:
      - /importante/secrets/conferencia-buenos-aires/.env
    networks:
      - traefik
networks:
  traefik:
    external: true
